### 计算机系统漫游
计算机系统是由硬件与系统软件组成，共同工作来运行应用程序。<br>
[-] 信息就是位+上下文。1byte = 8bit。每个字节表示程序中的某些文本文件。<br>
[-] 程序被其他程序翻译成不同的格式 可执行目标文件。<br>
`gcc -o hello hello.c` 预处理器，编译器，汇编器和链接器 一起构成编译系统。<br>
hello.c(源程序文本)--预处理器cpp-->hello.i(修改了的源程序文本)--编译器ccl-->hello.s(汇编程序文本)--汇编器as-->hello.o+printf.o(可重定位目标程序 二进制)--链接器(ld)-->hello(可执行目标程序 二进制)<br>

##### 了解编译系统如何工作大有益处
* 优化程序性能
* 理解链接时出现的错误
* 避免安全漏洞

##### 处理器读并解析储存在内存中的指令
shell是一个命令行解析器。

##### 系统的硬件组成
* 总线

    总线贯穿整个系统的一组电子管道，携带信息字节并负责在各个部件间传递。通常设计成传送定长的字节块(字)。
* IO设备

    磁盘-控制器-适配器 通过总线相连。
* 主存

    临时存储设备 处理器执行程序时，用来存放程序和程序处理的数据。DRAM，线性字节数组，每个字节都有其唯一的地址(数组索引)。
* 处理器

    中央处理单元 解释或执行 存储在主存中指令的引擎。处理器的核心是一个大小为一个字(8bytes 或 4bytes)的存储设备(或寄存器)，称为程序计数器(PC)。在任何时刻，PC都指向主存中某条机器语言指令。<br>
    从通电到停电，处理器一直在不断地执行程序计数器指向的指令，再更新程序计数器，使其指向下一条指令。<br>
    处理器是由指令集架构模型决定的。在这个模型中，指令按照严格的顺序执行，而执行一条指令包含执行一系列的步骤。<br>
    处理器从程序计数器指向的内存处，读取指令，解释指令中的位，执行该指令指示的简单操作，然后更新PC，使其指向下一条指令，而这条指令并不一定和在内存中刚刚执行的指令相邻。<br>
    寄存器文件是一个小的存储设备，由一些单个字长的寄存器组成，每个寄存器都有唯一的命名。<br>
    ALU 计算新的数据和地址值。CPU在指令下可能会执行的操作，加载-存储-操作-跳转。<br>

##### 高速缓存 L1-L2-L3三级缓存
L1和L2高速缓存是用一种叫做静态随机访问存储器(SRAM) 的硬件技术实现。L3是第三层。高速缓存 主要存放处理器可能经常访问的数据。寄存器可存放几百字节信息，高速缓存存放过几万字节的信息，主存则是几+亿字节信息。<br>
高速缓存的局部性原理，即程序具有访问局部区域里的数据和代码的趋势。<br>
存储器层次结构。存储器层次结构主要思想是上一层的存储器作为低一层存储器的高速缓存。层层递进。<br>

操作系统功能：防止硬件时被失控的应用程序滥用；向应用程序提供简单一致的机制来控制复杂而又通常大不相同的低级硬件设备。<br>
操作系统抽象概念 进程 虚拟内存和文件实现上面两个功能。👆。<br>

文件是对IO设备的抽象，虚拟内存是对主存和磁盘IO设备的抽象表示，进程则是对处理器、主存和IO设备的抽象。<br>

##### 进程 进程是操作系统对一个正在运行的程序的一种抽象
在一个系统上可以运行多个进程，每个进程都好像独占硬件设备。**并发指的是一个程序和另一个程序的指令交错执行。**<br>
操作系统保持跟踪进程运行所需的所有状态信息。也就是上下文，包括许多信息，比如PC和寄存器文件的当前值，以及主存的内容。<br>
从一个进程到另一个进程的转换是由操作系统内核管理的。内核是操作系统代码常驻主存的部分。当应用程序需要操作系统的某些操作时，比如读写文件呢，他就执行一条特殊的系统调用(system call)指令，将控制权传递给内核。然后内核执行被请求的操作并返回应用程序。**内核不是一个独立的进程，是系统管理全部进程所用代码和数据结构的集合。**<br>

##### 线程 可共享同样的代码和数据的执行单元。
##### 虚拟内存 为每个进程提供一个假象，即每个进程都在独占地使用主存 每个进程看到的内存都是一致的，称为虚拟地址空间
|内核虚拟内存|⬆️用户代码不可见的内存|
|--|--|
|用户栈(运行时创建)|*|
|⬇️|*|
|⬆️|*|
|共享库的内存映射区域|printf函数|
|⬆️|*|
|运行时堆(在运行时由malloc创建)|*|
|读/写数据|*|
|只读的代码和数据|从hello可执行文件加载进来的|
|0////|程序开始|

##### 文件 文件就是字节序列
每个IO设备，都可以看成是文件 甚至网络。

##### 系统之间利用网络通信
系统从主存复制一串字节到网络适配器，数据流经过网络到达另一台机器，而不是到达本地磁盘驱动器。<br>

##### Amdalhl定律
计算加速比 S = Told/Tnew = 1/((1-a)+a/k)<br>
想要显著加速整个系统，必须提升全系统中相当大的部分的速度。<br>

##### 并发与并行 Do more and Do faster
并发 指一个同时具有多个活动的系统；并行 用并发来使一个系统运行得更快。<br>
###### 线程级并发
构建在进程这个抽象之上，能够设计出同时有多个程序执行的系统，导致并发。就像一个杂耍🤹‍♀️艺人，同时保持多个球在空中飞舞。<br>
随着多个处理器和超线程的出现，多处理器系统出现。<br>

多核处理器是将多个CPU集成到一个集成电路芯片上。微处理器芯片有四个CPU核，每个核有L1-两部分 一部分存储数据，一部分存储指令和L2-统一高速缓存，存储数据与指令，L3高速缓存所有内核共享。<br>
超线程，有时称为同时多线程，是一项允许一个CPU执行多个控制流的技术。它涉及CPU某些硬件有多个备份，比如程序计数器和寄存器文件，而其他硬件部分只有一份，例如执行浮点算术运算的单元。<br>

城轨的处理器需要大约20000个时钟周期做不同线程间的转换，而超线程的处理器可以在单个周期的基础上决定要执行哪个线程。这使得CPU能够很好地利用它的处理资源。<br>

###### 指令级并行
在较低的抽象层次，现代处理器可以同时执行多条指令的属性称为指令级并行。

###### 单指令、多数据并行
允许一条指令产生多个可以并行执行的操作，这种方式称为单指令、多数据，即SIMD并行。

##### 计算机系统中抽象 是最为重要的概念
处理器里，指令集架构提供了对实际处理器硬件的抽象。文件是对IO设备的抽象，虚拟内存是对程序存储器的抽象，而进程是对一个正在运行的程序的抽象。虚拟机则是对整个计算机的抽象。
